
<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1013"/>

<div>
<span><div><div><span style="font-size: 14pt;">#免密登录</span></div><div><span style="font-size: 14pt; box-sizing: border-box;">[</span><span style="box-sizing: border-box;"><span style="font-size: 14pt;">root@</span><span style="font-size: 14pt;">k8s</span></span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master01</span> <span style="box-sizing: border-box; font-size: 14pt;">~]#</span> <span style="box-sizing: border-box; font-size: 14pt;">ssh</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">keygen</span> <span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">t rsa</span></div><div><span style="font-size: 14pt;"><span style="box-sizing: border-box; font-size: 14pt;">[</span><span style="box-sizing: border-box; font-size: 14pt;">root@k8s</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master01</span> <span style="box-sizing: border-box; font-size: 14pt;">~]#</span><span style="font-size: 14pt;"> </span><span style="-webkit-font-smoothing: antialiased; max-width: 100%; white-space: pre; overflow-wrap: normal; background: rgb(242, 245, 249); overflow: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; word-break: normal; border: 0px; font-size: 14pt; color: rgb(51, 51, 51); font-stretch: normal; font-style: normal; font-variant: normal; font-weight: 400; line-height: 1.45;">ssh-copy-id node01.k8s</span></span></div><div><br clear="none"/></div><div><span style="font-size: 14pt;">#设置系统主机名及Host文件的相互解析</span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt;">hostnamectl set-hostname </span><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">apiserver.demo</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="text-align: start;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">cat &gt;&gt;/etc/hosts&lt;&lt;EOF</span></div><div style="text-align: start;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">192.168.10.200 master.k8s</span></div><div style="text-align: start;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">192.168.10.201 node01.k8s</span></div><div style="text-align: start;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">192.168.10.202 node02.k8s</span></div><div style="text-align: start;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">192.168.10.203 node03.k8s</span></div><div style="text-align: start;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">192.168.10.204 node04.k8s</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">EOF</span></div><div><span style="font-size: 14pt;"><br clear="none"/></span></div><div><span style="font-size: 14pt;">#安装依赖包</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">yum install -y \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">yum-utils \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">device-mapper-persistent-data \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">lvm2 \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">conntrack \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">ntpdate \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">ntp \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">ipvsadm \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">ipset \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">jq \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">iptables \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">curl \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">sysstat \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">libseccomp \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">wget \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">vim \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">net-tools \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">git </span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#设置防火墙为iptables并设置空规则</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">yum install -y iptables-services &amp;&amp; systemctl start iptables &amp;&amp; systemctl enable iptables &amp;&amp; iptables -F &amp;&amp; service iptables save</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#关闭selinux</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">setenforce 0</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#关闭swap分区</span></div><div style="margin-top: 1em; margin-bottom: 1em; text-align: start;"><span style="-en-paragraph:true;"><span style="font-size: 14pt;">swapoff -a</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="-webkit-font-smoothing: antialiased; max-width: 100%; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(61, 70, 77); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.8;">sed -ri 's/.*swap.*/#&amp;/' /etc/fstab</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#调整内核参数，对于k8s</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">cat &gt; </span><span style="font-size: 14pt;">/etc/sysctl.d/kuberbetes.conf</span> <span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">&lt;&lt; EOF</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">net.bridge.bridge-nf-call-ip6tables = 1</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">net.bridge.bridge-nf-call-iptables = 1</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">net.ipv4.ip_forward = 1</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(61, 70, 77); font-variant-caps: normal; font-variant-ligatures: normal;">net.ipv4.ip_nonlocal_bind=1</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">net.ipv4.tcp_tw_recycle = 0</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">vm.swappiness=0 #禁止使用swap空间，只有当系统ooM时才允许使用它</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">vm.overcommit_memory=1 #不检查物理内存是否够用</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">vm.panic_on_oom=0 #开启oom</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">fs.inotify.max_user_instances=8192</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt;">fs.inotify.max_user_watches=1048576</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">fs.file-max=52706963</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">fs.nr_open=52706963</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">net.ipv6.conf.all.disable_ipv6=1</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">net.netfilter.nf_conntrack_max=2310720</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">EOF</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">sysctl -p </span><span style="font-size: 14pt;">/etc/sysctl.d/kuberbetes.conf</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#设置系统时区为中国上海</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">timedatectl set-timezone Asia/Shanghai</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#将当前UTC时间写入硬件时钟</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">timedatectl set-local-rtc 0</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#重启依赖于系统时间的服务</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">systemctl restart rsyslog</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">systemctl restart crond</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#关闭系统不需要的服务</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">systemctl stop postfix &amp;&amp; systemctl disable postfix</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#设置rsyslogd和systemd journald</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">mkdir -p /var/log/journal #持久化保存日志的目录</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">mkdir -p /etc/systemd/journald.conf.d</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;EOF</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">[Journal]</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#持久化保存到磁盘</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">Storage=persistent</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#压缩历史日志</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">Compress=yes</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">SyncIntervalSec=5m</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">RateLimitInterval=30s</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">RateLimitBurst=1000</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#最大占用空间10g</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">SystenMaxUse=10G</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#单日志文件最大200m</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">SystemMaxFileSize=200M</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"># 日志保存时间为2周</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">MaxRetentionSec=2week</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#不将日志转发到syslog</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">ForwardToSyslog=no</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">EOF</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">systemctl restart systemd-journald</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#升级系统内核为4.44</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">rpm -Uvh</span> <a href="http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm" shape="rect" style="font-size: 14pt;">http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</a></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">yum --enablerepo=elrepo-kernel install -y kernel-lt</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#设置开机从新内核启动</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">grub2-set-default &quot;CentOS Linux (4.4.182-1.el7.elrepo.x86_64) 7 (Core)&quot; &amp;&amp; reboot</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#kube-proxy开启ipvs的前置条件</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#!/bin/bash</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">modprobe -- ip_vs</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">modprobe -- ip_vs_rr</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">modprobe -- ip_vs_wrr</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">modprobe -- ip_vs_sh</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">modprobe -- nf_conntrack_ipv4</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">EOF</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#安装docker</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">yum-config-manager --add-repo </span><a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo" shape="rect" style="border: 0px; cursor: pointer; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em; text-decoration: underline;">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">yum install -y docker-ce-18.09.7 docker-ce-cli-18.09.7 containerd.io</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">#yum update -y ; yum install -y docker-ce</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">systemctl enable docker &amp;&amp;   systemctl start docker</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">#mkdir /etc/docker</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span></span></div><div style="text-align: start;">{</div><div style="text-align: start;">&quot;registry-mirrors&quot;: [&quot;<a href="https://v16stybc.mirror.aliyuncs.com/" shape="rect">https://v16stybc.mirror.aliyuncs.com</a>&quot;],</div><div style="text-align: start;">&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</div><div style="text-align: start;">&quot;insecure-registries&quot;: [&quot;192.168.10.200:5000&quot;],</div><div style="text-align: start;">&quot;log-driver&quot;: &quot;json-file&quot;,</div><div style="text-align: start;">        &quot;log-opts&quot;: {</div><div style="text-align: start;">                &quot;max-size&quot;: &quot;10m&quot;,</div><div style="text-align: start;">                &quot;max-file&quot;:&quot;5&quot;</div><div style="text-align: start;">        }</div><div style="text-align: start;">}</div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">EOF</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">mkdir -p /etc/systemd/system/docker.service.d</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">#重启docker服务</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px;"><span style="font-size: 14pt; line-height: 1.57143em;">systemctl daemon-reload &amp;&amp; systemctl restart docker</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="font-size: 14pt; line-height: 1.57143em;">#安装kubeadm</span></div><div style="margin: 0px; padding: 0px; border: 0px; text-align: start;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">[kubernetes]</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">name=Kubernetes</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">baseurl=</span><a href="http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64" shape="rect" style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; cursor: pointer; font-size: 14pt; color: rgb(4, 122, 198); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</a></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">enabled=1</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">gpgcheck=0</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">repo_gpgcheck=0</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">gpgkey=</span><a href="http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg" shape="rect" style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; cursor: pointer; font-size: 14pt; color: rgb(4, 122, 198); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</a></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">       </span><a href="http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg" shape="rect" style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; cursor: pointer; font-size: 14pt; color: rgb(4, 122, 198); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</a></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">EOF</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal;">yum install -y kubelet-1.15.1 kubeadm-1.15.1 kubectl-1.15.1</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="font-size: 14pt; line-height: 1.57143em;">systemctl enable kubelet.service</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="font-size: 14pt; line-height: 1.57143em;">#初始化主节点</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="font-size: 14pt; line-height: 1.57143em;">kubeadm config print init-defaults &gt; kubeadm-config.yaml</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="font-size: 14pt; line-height: 1.57143em;">#修改kubeadm-config.yaml至如下</span></span></div><div style="text-align: start;"><span style="font-size: 14pt;">apiVersion: kubeadm.k8s.io/v1beta2</span></div><div style="text-align: start;"><span style="font-size: 14pt;">bootstrapTokens:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">- groups:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  - system:bootstrappers:kubeadm:default-node-token</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  token: abcdef.0123456789abcdef</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  ttl: 24h0m0s</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  usages:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  - signing</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  - authentication</span></div><div style="text-align: start;"><span style="font-size: 14pt;">kind: InitConfiguration</span></div><div style="text-align: start;"><span style="font-size: 14pt;">localAPIEndpoint:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  advertiseAddress: 192.168.10.200  #当前主节点ip</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  bindPort: 6443</span></div><div style="text-align: start;"><span style="font-size: 14pt;">nodeRegistration:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  criSocket: /var/run/dockershim.sock</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  name: master.k8s</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  taints:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  - effect: NoSchedule</span></div><div style="text-align: start;"><span style="font-size: 14pt;">    key: node-role.kubernetes.io/master</span></div><div style="text-align: start;"><span style="font-size: 14pt;">---</span></div><div style="text-align: start;"><span style="font-size: 14pt;">apiServer:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  timeoutForControlPlane: 4m0s</span></div><div style="text-align: start;"><span style="font-size: 14pt;">apiVersion: kubeadm.k8s.io/v1beta2</span></div><div style="text-align: start;"><span style="font-size: 14pt;">certificatesDir: /etc/kubernetes/pki</span></div><div style="text-align: start;"><span style="font-size: 14pt;">clusterName: kubernetes</span></div><div style="text-align: start;"><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(57, 56, 46); font-size: 14pt; color: rgb(102, 217, 239); font-variant-caps: normal; font-variant-ligatures: normal;">#controlPlaneEndpoint</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(57, 56, 46); font-size: 14pt; color: rgb(248, 248, 242); font-variant-caps: normal; font-variant-ligatures: normal;">:</span> <span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(57, 56, 46); font-size: 14pt; color: rgb(230, 219, 116); font-variant-caps: normal; font-variant-ligatures: normal;">&quot;192.168.10.199:8443&quot; #keeplive虚拟的ip</span></div><div style="text-align: start;"><span style="font-size: 14pt;">controllerManager: {}</span></div><div style="text-align: start;"><span style="font-size: 14pt;">dns:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  type: CoreDNS</span></div><div style="text-align: start;"><span style="font-size: 14pt;">etcd:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  local:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">    dataDir: /var/lib/etcd</span></div><div style="text-align: start;"><span style="font-size: 14pt;">imageRepository: </span> <a href="http://registry.cn-hangzhou.aliyuncs.com/google_containers" shape="rect" style="font-size: 14pt;">registry.cn-hangzhou.aliyuncs.com/google_containers</a><span style="font-size: 14pt;">  #修改为国内镜像源</span></div><div style="text-align: start;"><span style="font-size: 14pt;">kind: ClusterConfiguration</span></div><div style="text-align: start;"><span style="font-size: 14pt;">kubernetesVersion: v1.15.1   #当前版本</span></div><div style="text-align: start;"><span style="font-size: 14pt;">networking:</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  dnsDomain: cluster.local</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  podSubnet: &quot;10.244.0.0/16&quot;  #添加，此为flannel网络默认网段,也可修改插件yaml文件中的网段，也可只写&quot;&quot;</span></div><div style="text-align: start;"><span style="font-size: 14pt;">  serviceSubnet: 10.96.0.0/12</span></div><div style="text-align: start;"><span style="font-size: 14pt;">scheduler: {}</span></div><div><span style="font-size: 14pt;">---</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">apiVersion: kubeproxy.config.k8s.io/v1alpha1   #末尾添加，修改为ipvs调度模式</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">kind: KubeProxyConfiguration</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">featureGates: </span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">  SupportIPVSProxyMode: true</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">mode: ipvs</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 14pt;">#初始化时自动颁发证书，后续版本用</span></div><div>--upload-certs</div></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">kubeadm ini</span><span style="font-size: 14pt;">t --config=kubeadm-config.yaml --experimental-upload-certs | tee kubeadm-init.log</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">rm -rf /root/.kube/ ;</span></span><span style="font-size: 14pt;">mkdir /root/.kube/ ;cp -i /etc/kubernetes/admin.conf /root/.kube/config</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div><span style="box-sizing: border-box;"><span style="font-size: 14pt;">#kubectl默认会在执行的用户家目录下面的.kube目录下寻找config文件。这里是将在初始化时[kubeconfig]步骤生成的admin.conf拷贝到.kube/config</span></span></div><div><span style="box-sizing: border-box; font-size: 14pt;">mkdir</span> <span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">p $HOME</span><span style="box-sizing: border-box; font-size: 14pt;">/.</span><span style="box-sizing: border-box; font-size: 14pt;">kube</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">sudo cp</span> <span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">i</span> <span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">admin</span><span style="box-sizing: border-box; font-size: 14pt;">.</span><span style="box-sizing: border-box; font-size: 14pt;">conf $HOME</span><span style="box-sizing: border-box; font-size: 14pt;">/.</span><span style="box-sizing: border-box; font-size: 14pt;">kube</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">config</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">sudo chown $</span><span style="box-sizing: border-box; font-size: 14pt;">(</span><span style="box-sizing: border-box; font-size: 14pt;">id</span> <span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">u</span><span style="box-sizing: border-box; font-size: 14pt;">):</span><span style="box-sizing: border-box; font-size: 14pt;">$</span><span style="box-sizing: border-box; font-size: 14pt;">(</span><span style="box-sizing: border-box; font-size: 14pt;">id</span> <span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">g</span><span style="box-sizing: border-box; font-size: 14pt;">)</span> <span style="box-sizing: border-box; font-size: 14pt;">$HOME</span><span style="box-sizing: border-box; font-size: 14pt;">/.</span><span style="box-sizing: border-box; font-size: 14pt;">kube</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">config</span></div><div><br clear="none"/></div><div><span style="font-size: 14pt;"><span style="box-sizing: border-box; font-size: 14pt;">在</span><span style="box-sizing: border-box; font-size: 14pt;">k8s</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master01</span><span style="box-sizing: border-box; font-size: 14pt;">将证书文件拷贝至</span><span style="box-sizing: border-box; font-size: 14pt;">k8s</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master02</span><span style="box-sizing: border-box; font-size: 14pt;">、</span><span style="box-sizing: border-box; font-size: 14pt;">k8s</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master03</span><span style="box-sizing: border-box; font-size: 14pt;">节点</span></span></div><div><span style="box-sizing: border-box;"><span style="font-size: 14pt;">#拷贝证书至k8s-master02节点</span></span></div><div><span style="box-sizing: border-box; font-size: 14pt;">[</span><span style="box-sizing: border-box; font-size: 14pt;">root@k8s</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master01</span> <span style="box-sizing: border-box; font-size: 14pt;">~]#</span> <span style="box-sizing: border-box; font-size: 14pt;">vim</span> <span style="box-sizing: border-box; font-size: 14pt;">/tmp</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">k8s</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">master</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">zhengshu</span><span style="box-sizing: border-box; font-size: 14pt;">.</span><span style="box-sizing: border-box; font-size: 14pt;">sh</span></div><div><span style="box-sizing: border-box;"><span style="font-size: 14pt;">#!/bin/bash</span></span></div><div><span style="font-size: 14pt;"><span style="box-sizing: border-box; font-size: 14pt;">USER</span><span style="box-sizing: border-box; font-size: 14pt;">=</span><span style="box-sizing: border-box; font-size: 14pt;">root</span></span></div><div><span style="font-size: 14pt;"><span style="box-sizing: border-box; font-size: 14pt;">CONTROL_PLANE_IPS</span><span style="box-sizing: border-box; font-size: 14pt;">=</span><span style="box-sizing: border-box; font-size: 14pt;">&quot;node01.k8s  node02.k8s&quot;</span></span></div><div><span style="box-sizing: border-box; font-size: 14pt;">for</span> <span style="box-sizing: border-box; font-size: 14pt;">host</span> <span style="box-sizing: border-box; font-size: 14pt;">in</span> <span style="box-sizing: border-box; font-size: 14pt;">$</span><span style="box-sizing: border-box; font-size: 14pt;">{</span><span style="box-sizing: border-box; font-size: 14pt;">CONTROL_PLANE_IPS</span><span style="box-sizing: border-box; font-size: 14pt;">};</span> <span style="box-sizing: border-box; font-size: 14pt;">do</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">ssh</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;${USER}&quot;</span><span style="box-sizing: border-box; font-size: 14pt;">@$host</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;mkdir -p /etc/kubernetes/pki/etcd&quot;</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">scp</span> <span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">ca</span><span style="box-sizing: border-box; font-size: 14pt;">.*</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;${USER}&quot;</span><span style="box-sizing: border-box; font-size: 14pt;">@$host</span><span style="box-sizing: border-box; font-size: 14pt;">:</span><span style="box-sizing: border-box; font-size: 14pt;">/etc/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">scp</span> <span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">sa</span><span style="box-sizing: border-box; font-size: 14pt;">.*</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;${USER}&quot;</span><span style="box-sizing: border-box; font-size: 14pt;">@$host</span><span style="box-sizing: border-box; font-size: 14pt;">:</span><span style="box-sizing: border-box; font-size: 14pt;">/etc/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">scp</span> <span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">front</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">proxy</span><span style="box-sizing: border-box; font-size: 14pt;">-</span><span style="box-sizing: border-box; font-size: 14pt;">ca</span><span style="box-sizing: border-box; font-size: 14pt;">.*</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;${USER}&quot;</span><span style="box-sizing: border-box; font-size: 14pt;">@$host</span><span style="box-sizing: border-box; font-size: 14pt;">:</span><span style="box-sizing: border-box; font-size: 14pt;">/etc/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">scp</span> <span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etcd</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">ca</span><span style="box-sizing: border-box; font-size: 14pt;">.*</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;${USER}&quot;</span><span style="box-sizing: border-box; font-size: 14pt;">@$host</span><span style="box-sizing: border-box; font-size: 14pt;">:</span><span style="box-sizing: border-box; font-size: 14pt;">/etc/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etcd</span><span style="box-sizing: border-box; font-size: 14pt;">/</span></div><div><span style="box-sizing: border-box; font-size: 14pt;">scp</span> <span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">admin</span><span style="box-sizing: border-box; font-size: 14pt;">.</span><span style="box-sizing: border-box; font-size: 14pt;">conf</span> <span style="box-sizing: border-box; font-size: 14pt;">&quot;${USER}&quot;</span><span style="box-sizing: border-box; font-size: 14pt;">@$host</span><span style="box-sizing: border-box; font-size: 14pt;">:</span><span style="box-sizing: border-box; font-size: 14pt;">/etc/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span></div><div><span style="box-sizing: border-box;"><span style="font-size: 14pt;">done</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#部署flannel网络,</span><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">只在 master 节点执行（flannel的国外镜像pull失败，</span></span><span style="font-size: 14pt; color: rgb(56, 56, 56);">image: <a href="http://registry.cn-shanghai.aliyuncs.com/gcr-k8s/flannel:v0.10.0-amd64" shape="rect" style="font-size: 14pt;">registry.cn-shanghai.aliyuncs.com/gcr-k8s/flannel:v0.10.0-amd64</a></span><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">）</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(56, 56, 56);">kubectl apply -f <a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" shape="rect" style="font-size: 14pt;">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;"># 或者部</span><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">署</span></span><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;"> calico网络,</span><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">只在 master 节点执行</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">kubectl apply -f</span><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;"> </span><a href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml" shape="rect" style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; cursor: pointer; font-size: 14pt; color: rgb(4, 122, 198); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">https://do</a><a href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml" shape="rect" style="font-size: 14pt; color: rgb(4, 122, 198); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">cs.projectcalico.org/v3.6/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml</a></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#修改calico.yaml，修改CALICO_IPV4POOL_CID</span><span style="font-size: 14pt;">R这个下面的vaule值。与kubeadm初始化文件中的serviceSubnet的值对应</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;"># 在 master 节点执行，获得worker节点加入集群的命令</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">kubeadm token create --print-join-command</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">#所有其他master加入集群时</span><span style="font-size: 14pt; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">带参数</span></span><span style="font-size: 14pt;"> </span><span style="font-size: 14pt;">--experimental-control-plane</span></div><hr/><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;"><br clear="none"/></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">#master故障后恢复</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">#先观察集群状态</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">kubectl get endpoints kube-controller-manager --namespace=kube-system -o yaml</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">kubectl get endpoints kube-scheduler --namespace=kube-system -o yaml</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">kubectl -n kube-system exec etcd-k8s-master01节点 --etcdctl  \</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">--</span><span style="font-size: 14pt;">endpoints=https://192.168.10.200:2379  \</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">--ca-file=<span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/etcd/ca.crt  \</span></span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box;"><span style="font-size: 14pt;">--cer</span><span style="font-size: 14pt;">t-file=</span></span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/etcd/server.crt  \</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 14pt;">--key-file=</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">etc</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">kubernetes</span><span style="box-sizing: border-box; font-size: 14pt;">/</span><span style="box-sizing: border-box; font-size: 14pt;">pki</span><span style="box-sizing: border-box; font-size: 14pt;">/etcd/server.key   cluster-health</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">#降低已恢复master的keeplived的优先级（待验证，可能是配置问题）</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">#或修改  .kube/config 中的连接ip地址，否则kubelet命令会失效</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18.6667px;">#kubectl delete 故障节点</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;">#验证etcd中的故障master信息是否删除，否则修改</span></div><div style="text-align: start;"><span style="font-size: 14pt;">kubectl edit configmaps -n kube-system kubeadm-config</span></div><div style="text-align: start;"><span style="font-size: 14pt;">#从健康master拷贝ca等证书到各目录</span></div><div style="text-align: start;"><span style="font-size: 14pt;">#</span><span style="border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(56, 56, 56); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">kubeadm token create --print-join-command且带</span><span style="font-size: 14pt;">--experimental-control-plane</span></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div><div style="margin: 0px; padding: 0px; border: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br clear="none"/></div></div><div><br clear="none"/></div></span>
</div></body></html>
